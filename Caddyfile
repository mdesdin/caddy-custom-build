{
	admin 0.0.0.0:2019

	email {env.ACME_EMAIL}

	acme_dns cloudflare {env.CF_API_TOKEN}

	servers {
        	trusted_proxies combine {
			cloudflare {
        	    		interval 12h
            			timeout 15s
			}
			static static 172.16.0.0/16
		}
		client_ip_headers Cf-Connecting-Ip X-Real-Ip
	}

	events {
		on cert_obtained exec /scripts/certaction.sh {event.data.identifier} {event.data.certificate_path} {event.data.private_key_path}
	}

	order crowdsec before respond

	crowdsec {
		api_url http://crowdsec:8080
		api_key {env.CROWDSEC_API_KEY}
		ticker_interval 3s
		appsec_url http://crowdsec:7422
		#disable_streaming
		#enable_hard_fails
	}
}

(accesslog) {
	log {
		output file /var/log/caddy/access-{args[0]}.log
	}
}

(crowdsecurity) {
	crowdsec
}
